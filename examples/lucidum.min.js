"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var possibleEventList=["input","change","submit","reset","keydown","keypress","keyup","mouseenter","mouseover","mousemove","mousedown","mouseup","auxclick","click","dblclick","contextmenu","wheel","mouseleave","mouseout","select","dragstart","drag","dragend","dragenter","dragover","dragleave","drop","durationchange","loadedmetadata","loadeddata","canplay","canplaythrough","ended","emptied","stalled","suspend","play","playing","pause","waiting","seeking","seeked","ratechange","timeupdate","volumechange","complete","audioprocess"],possibleAttributeList=["accept","accept-charset","accesskey","action","align","alt","async","autocapitalize","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","http-equiv","name","contenteditable","contextmenu","controls","coords","crossorigin","data","data-*","datetime","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","method","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","integrity","ismap","itemprop","keytype","kind","label","lang","language","list","loop","low","manifest","max","maxlength","minlength","media","method","GET","POST","min","multiple","email","file","muted","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","seamless","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","translate","text","type","usemap","value","width","wrap","lucidumid","loopfor"],ObservableSlim=function(){var e=[],t=[],n=[],r=null,o=function o(i,a,l,s){var c=l||null,u=s||"",p=[],d=function(e,t){return e instanceof Array?""!==u?u:t:""!==u?u+"."+t:t},f=function(e){if(!0!==c.paused)if(!0===a)setTimeout(function(){if(e===p.length){for(var t=0;t<c.observers.length;t++)c.observers[t](p);p=[]}},10);else{for(var t=0;t<c.observers.length;t++)c.observers[t](p);p=[]}},h={get:function(e,t){if("__getTarget"===t)return e;if("__isProxy"===t)return!0;if("__getParent"===t)return function(t){if(void 0===t)t=1;var n,r=d(e,"__getParent").split(".");return r.splice(-(t+1),t+1),n=c.parentProxy,r.join(".").split(".").reduce(function(e,t){return e?e[t]:void 0},n||self)};var n=e[t];if(n instanceof Object&&null!==n&&e.hasOwnProperty(t)){!0===n.__isProxy&&(n=n.__getTarget);for(var r=-1,i=c.targets,l=0,s=i.length;l<s;l++)if(n===i[l]){r=l;break}return r>-1?c.proxies[r]:o(n,a,c,""!==u?u+"."+t:t)}return n},deleteProperty:function(e,o){var i=!0;r===m&&(i=!1,r=null);var a=Object.assign({},e),l=d(e,o);if(p.push({type:"delete",target:e,property:o,newValue:null,previousValue:a[o],currentPath:l,proxy:m}),!0===i){for(var s=0,c=t.length;s<c&&e!==t[s];s++);for(var u=n[s],h=u.length;h--;)u[h].proxy!==m&&(r=u[h].proxy,delete u[h].proxy[o]);delete e[o]}return f(p.length),!0},set:function(e,o,i,a){var l=!0;r===m&&(l=!1,r=null);var s=e[o];if(s!==i||!1===l){var u=_typeof(s),h=d(e,o),v="update";if("undefined"===u&&(v="add"),p.push({type:v,target:e,property:o,newValue:i,previousValue:a[o],currentPath:h,proxy:m}),!0===l){for(var b=0,g=t.length;b<g&&e!==t[b];b++);var y=n[b],L=0;for(g=y.length;L<g;L++)y[L].proxy!==m&&(r=y[L].proxy,y[L].proxy[o]=i);setTimeout(function(){if("object"===u&&null!==s){for(var r=Object.keys(e),o=0,i=r.length;o<i;o++)if(e[r[o]]===s)return void console.log("target still exists");!function e(r){for(var o=Object.keys(r),i=0,a=o.length;i<a;i++){var l=r[o[i]];l instanceof Object&&null!==l&&e(l)}var s=-1;for(i=0,a=t.length;i<a;i++)if(r===t[i]){s=i;break}if(s>-1){for(var u=n[s],p=u.length;p--;)if(c===u[p].observable){u.splice(p,1);break}0==u.length&&(n.splice(s,1),t.splice(s,1))}}(s)}},1e4),e[o]=i}f(p.length)}return!0}},m=new Proxy(i,h);null===c?(c={parentTarget:i,domDelay:a,parentProxy:m,observers:[],targets:[i],proxies:[m],paused:!1,path:u},e.push(c)):(c.targets.push(i),c.proxies.push(m));for(var v={target:i,proxy:m,observable:c},b=-1,g=0,y=t.length;g<y;g++)if(i===t[g]){b=g;break}return b>-1?n[b].push(v):(t.push(i),n.push([v]),b=t.length-1),m};return{create:function(e,t,n){if(!0===e.__isProxy)e=e.__getTarget;var r=o(e,t);return"function"==typeof n&&this.observe(r,n),function e(t){for(var n=t.__getTarget,r=Object.keys(n),o=0,i=r.length;o<i;o++){var a=r[o];n[a]instanceof Object&&null!==n[a]&&e(t[a])}}(r),r},observe:function(t,n){for(var r=e.length;r--;)if(e[r].parentProxy===t){e[r].observers.push(n);break}},pause:function(t){for(var n=e.length,r=!1;n--;)if(e[n].parentProxy===t){e[n].paused=!0,r=!0;break}if(0==r)throw new Error("ObseravableSlim could not pause observable -- matching proxy not found.")},resume:function(t){for(var n=e.length,r=!1;n--;)if(e[n].parentProxy===t){e[n].paused=!1,r=!0;break}if(0==r)throw new Error("ObseravableSlim could not resume observable -- matching proxy not found.")},remove:function(r){for(var o=null,i=!1,a=e.length;a--;)if(e[a].parentProxy===r){o=e[a],i=!0;break}for(var l=n.length;l--;)for(var s=n[l].length;s--;)n[l][s].observable===o&&(n[l].splice(s,1),0==n[l].length&&(n.splice(l,1),t.splice(l,1)));!0===i&&e.splice(a,1)}}}();try{module.exports=ObservableSlim}catch(e){}var interpolationReg=/({{.*?}})/,globalInterpolationReg=/({{.*?}})/g,innerInterpolationReg=/[\w\.]+/,innerDataPropInterpolationReg=/\b\w.+\b(?!(\(\)))/,innerFunctionInterpolationReg=/\w+\(\)/,dataReg=/([.a-zA-Z])+/g,currentLucidumId=0,Lucidum=function(){function e(t){var n=this;_classCallCheck(this,e);var r=this;for(var o in this.data=ObservableSlim.create(t.data,!0,function(e){var t=e[0].currentPath,n=e[0].newValue,o=e[0].previousValue;if(r.watchersPropList&&r.watchersPropList.includes(t)){var i=r.watchers.findIndex(function(e){return e.prop});r.watchers[i].fn.apply(r.data,[n,o])}r.bindValPropList.includes(t)&&document.querySelectorAll("".concat(r.appContainerElement," *[bindval^='").concat(t,"']")).forEach(function(e){return e.value=n});var a=t.replace(/.\d.\w.*/g,"");r.loopForPropList.includes(a)&&r.updateLoopElements(a),r.loopForPropList.includes(t)||r.render(t)}),this.methods=t.methods||{},this.interpolationElements={},this.components=t.components||{},t.onCreate&&t.onCreate.call(this.data),t.watch&&(this.watchers=t.watch,this.watchersPropList=[],this.compileWatchersPropList()),this.appContainerElement=t.el||"#app",document.querySelector(this.appContainerElement)||console.error("There was no app container found with the selector:",this.appContainerElement),this.computeInterpolatedFunctions(),this.computeInterpolatedProperties(),this.bindValPropList=[],this.ifShowCases={},this.ifShowPropList=[],this.currentConditionalEval=!1,this.interpolationElements)r.render(o);this.loopForElements={},this.loopForPropList=[],this.computeLoopProperties(),this.computeCustomAttributes(),this.compileIfShowPropList(),this.ifShowPropList.forEach(function(e){return n.updateConditionalElements(e)})}return _createClass(e,[{key:"computeInterpolatedFunctions",value:function(){var e=this;document.querySelectorAll("".concat(e.appContainerElement," *")).forEach(function(t){var n=t.innerHTML;null!==n.match(interpolationReg)&&uniq(n.match(globalInterpolationReg)).forEach(function(n){var r=n.match(innerFunctionInterpolationReg);null!==r&&(r=r[0].match(/\w+/)[0],e.methods[r]?t.innerHTML=t.innerHTML.replace(n,e.methods[r]()):console.error("No function with name: '".concat(r,"' exists.")))})})}},{key:"computeInterpolatedProperties",value:function(){var e=this,t=this;document.querySelectorAll("".concat(t.appContainerElement," *")).forEach(function(n){var r=n.innerHTML;null!==r.match(interpolationReg)&&uniq(r.match(globalInterpolationReg)).forEach(function(r){var o,i=r.match(innerDataPropInterpolationReg);null!==i&&(i=i[0],void 0!==resolveObjVal(t.data,i)?(o=n.attributes.lucidumid?Number(n.attributes.lucidumid.value):++currentLucidumId,n.setAttribute("lucidumid",o),e.interpolationElements[i]||(e.interpolationElements[i]=[]),e.interpolationElements[i].push({lucidumid:o,elContent:n.outerHTML})):n.parent&&!n.parent.children[0].attributes.loopfor&&console.error("No property with name: '".concat(i,"' exists.")))})})}},{key:"computeLoopProperties",value:function(){var e=this;document.querySelectorAll("".concat(e.appContainerElement," *")).forEach(function(t){var n=t.attributes.loopfor;if(n){var r=n.value.replace(/\s\s+/gi," ").trim();if(r.match(/( in | of )/)){var o=++currentLucidumId;if(t.setAttribute("lucidumid",o),"in"===(r=r.split(/( in | of )/))[1].trim()){var i=r[0].match(/\w.\S*\b/g);if(i.length>1){e.loopForPropList.push(r[2]),e.loopForElements[r[2]]={mainElId:o,otherElIds:[],originalContent:t.innerHTML};var a=resolveObjVal(e.data,r[2]),l=new RegExp("{{".concat(i[1],".*?}}")),s=new RegExp("{{".concat(i[0],"}}"),"g");if(a.length>0){t.style.display="";for(var c=a.length-1;c>0;c--){for(var u=t.cloneNode(!0);l.exec(u.innerHTML);){var p=u.innerHTML.match(l)[0].match(innerInterpolationReg)[0];if(void 0===(p=p.split("".concat(p.split(".")[0],"."))[1]))u.innerHTML=u.innerHTML.replace(l,a[c]);else{var d=resolveObjVal(e.data,"".concat(r[2]));u.innerHTML=u.innerHTML.replace(l,d[c][p])}}u.innerHTML=u.innerHTML.replace(s,c+1),o=++currentLucidumId,u.removeAttribute("loopfor"),e.loopForElements[r[2]].otherElIds.push(o),u.setAttribute("lucidumid",o),insertAfterEl(t,u)}for(;l.exec(t.innerHTML);){var f=t.innerHTML.match(l)[0].match(innerInterpolationReg)[0];if(void 0===(f=f.split("".concat(f.split(".")[0],"."))[1]))t.innerHTML=t.innerHTML.replace(l,a[0]);else{var h=resolveObjVal(e.data,"".concat(r[2]));t.innerHTML=t.innerHTML.replace(l,h[0][f])}}t.innerHTML=t.innerHTML.replace(s,1)}else t.style.display="none"}}else console.log("its a object loop")}else console.error("Invalid loopfor attribute at element:",t,"Please specify either 'in' or 'of'")}})}},{key:"updateLoopElements",value:function(e){for(var t=this,n=t.ifShowCases[e].length-1;n>-1;n--)document.querySelector("".concat(t.appContainerElement,' *[lucidumid="').concat(t.ifShowCases[e][n].lucidumid,'"]'))&&t.ifShowCases[e].splice(n,1);t.loopForElements[e].otherElIds.forEach(function(e){document.querySelector("".concat(t.appContainerElement,' *[lucidumid="').concat(e,'"]')).remove()}),t.loopForElements[e].otherElIds=[];var r=document.querySelector("".concat(t.appContainerElement,' *[lucidumid="').concat(t.loopForElements[e].mainElId,'"]'));r.innerHTML=t.loopForElements[e].originalContent;var o=r.attributes.loopfor;if(o){var i=o.value.replace(/\s\s+/gi," ").trim();if(i.match(/( in | of )/))if("in"===(i=i.split(/( in | of )/))[1].trim()){var a=i[0].match(/\w.\S*\b/g);if(a.length>1){var l=resolveObjVal(t.data,i[2]),s=new RegExp("{{".concat(a[1],".*?}}")),c=new RegExp("{{".concat(a[0],"}}"),"g");if(l.length>0){r.style.display="";for(var u=l.length-1;u>0;u--){for(var p=r.cloneNode(!0);s.exec(p.innerHTML);){var d=p.innerHTML.match(s)[0].match(innerInterpolationReg)[0];if(void 0===(d=d.split("".concat(d.split(".")[0],"."))[1]))p.innerHTML=p.innerHTML.replace(s,l[u]);else{var f=resolveObjVal(t.data,"".concat(i[2]));p.innerHTML=p.innerHTML.replace(s,f[u][d])}}p.innerHTML=p.innerHTML.replace(c,u+1);var h=++currentLucidumId;p.removeAttribute("loopfor"),t.loopForElements[i[2]].otherElIds.push(h),p.setAttribute("lucidumid",h),insertAfterEl(r,p)}for(;s.exec(r.innerHTML);){var m=r.innerHTML.match(s)[0].match(innerInterpolationReg)[0];if(void 0===(m=m.split("".concat(m.split(".")[0],"."))[1]))r.innerHTML=r.innerHTML.replace(s,l[0]);else{var v=resolveObjVal(t.data,"".concat(i[2]));r.innerHTML=r.innerHTML.replace(s,v[0][m])}}r.innerHTML=r.innerHTML.replace(c,1)}else r.style.display="none"}}else console.log("its a object loop");else console.error("Invalid loopfor attribute at element:",r,"Please specify either 'in' or 'of'")}t.computeCustomAttributes()}},{key:"computeCustomFunctions",value:function(e){var t=this;return e.match(dataReg).forEach(function(n){void 0!==resolveObjVal(t.data,n)&&(e=e.replace(n,"root.data.".concat(n))),t.methods[n]&&(e=e.replace("".concat(n,"()"),"root.methods['".concat(n,"'].call(root.data)")))}),e}},{key:"computeCustomAttributes",value:function(){var e=this;document.querySelectorAll("".concat(e.appContainerElement," *")).forEach(function(t){Array.from(t.attributes).forEach(function(n){if("@"===n.name.substr(0,1)){var r=n.name.substr(1),o=n.value;if(possibleEventList.includes(r)){var i=e.computeCustomFunctions(o);t.addEventListener(r,function(){Function('"use strict"; const root = this; '.concat(i,";")).call(e)}),t.removeAttribute("@".concat(r))}else console.error("Event ".concat(r," does not exist."))}else if("bindval"===n.name){var a=t.attributes.bindval.value.replace(/\s\s+/gi," ").trim(),l=a.split(" ")[0],s=a.split(" ")[1],c=_typeof(resolveObjVal(e.data,l));t.value=resolveObjVal(e.data,l);var u=e.computeCustomFunctions(l);"@input"===s||void 0===s?t.addEventListener("input",function(t){var n=t.target.value;n="number"===c?Number(n):"'".concat(n,"'"),Function('"use strict"; const root = this; '.concat(u," = ").concat(n,";")).call(e)}):t.addEventListener("change",function(t){var n=t.target.value;n="number"===c?Number(n):"'".concat(n,"'"),Function('"use strict"; const root = this; '.concat(u," = ").concat(n,";")).call(e)}),e.bindValPropList.includes(l)||e.bindValPropList.push(l)}else if("showif"===n.name){var p=t.attributes.showif.value,d=p.split(" "),f=d[0].match(/\w.*\B.(?=\[) ?/g);if(null!==f&&(d[0]=f[0]),void 0!==resolveObjVal(e.data,d[0])){void 0===e.ifShowCases[d[0]]&&(e.ifShowCases[d[0]]=[]);for(var h=++currentLucidumId,m=-1,v=!0,b=t.nextElementSibling;v;)null!==b?b.hasAttribute("showelse")?(v=!1,m=++currentLucidumId,b.setAttribute("lucidumid",m),b.removeAttribute("showelse")):b=b.nextElementSibling:v=!1;e.ifShowCases[d[0]].push({lucidumid:h,elseLucidumId:m,condition:p}),t.setAttribute("lucidumid",h)}}else{if(null!==/(data-)\w+/g.exec(n.name))return;possibleAttributeList.includes(n.name)||console.error("Attribute ".concat(n.name," does not exist."))}})})}},{key:"updateConditionalElements",value:function(e){var t=this;e.split(".").length>1&&(e=e.replace(/.\d.\w.*/g,"")),t.ifShowPropList.includes(e)&&t.ifShowCases[e].forEach(function(e){var n,r=document.querySelector('[lucidumid="'.concat(e.lucidumid,'"]'));if(void 0!==e.elseLucidumId&&(n=document.querySelector('[lucidumid="'.concat(e.elseLucidumId,'"]'))),null===r)return console.error("Element that had a conditional was removed and can not be found now."),!1;var o=t.computeCustomFunctions(e.condition);Function('"use strict"; const root = this; if('.concat(o,"){root.currentConditionalEval=true;}else{root.currentConditionalEval=false;}")).call(t),!0===t.currentConditionalEval?(r.style.display="",n&&(n.style.display="none")):!1===t.currentConditionalEval&&(r.style.display="none",n&&(n.style.display=""))})}},{key:"compileIfShowPropList",value:function(){for(var e in this.ifShowCases)this.ifShowPropList.push(e)}},{key:"compileWatchersPropList",value:function(){var e=this;e.watchers.forEach(function(t){return e.watchersPropList.push(t.prop)})}},{key:"render",value:function(e){var t=this,n=t.interpolationElements[e];n&&n.forEach(function(e){for(var n=document.querySelector("".concat(t.appContainerElement,' *[lucidumid="').concat(e.lucidumid,'"]')),r=e.elContent;interpolationReg.exec(r);){var o=interpolationReg.exec(r),i=innerInterpolationReg.exec(o[0])[0],a=resolveObjVal(t.data,i);r=r.replace(o[0],a)}n.outerHTML=r}),t.updateConditionalElements(e)}}]),e}();Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),r=n.length>>>0;if(0===r)return!1;var o,i,a=0|t,l=Math.max(a>=0?a:r-Math.abs(a),0);for(;l<r;){if((o=n[l])===(i=e)||"number"==typeof o&&"number"==typeof i&&isNaN(o)&&isNaN(i))return!0;l++}return!1}});var uniq=function(e){for(var t={},n=[],r=e.length,o=0,i=0;i<r;i++){var a=e[i];1!==t[a]&&(t[a]=1,n[o++]=a)}return n},resolveObjVal=function(e,t){for(t=t.split(".");t.length;){if("object"!==_typeof(e))return;e=e[t.shift()]}return e},insertAfterEl=function(e,t){e.parentNode.insertBefore(t,e.nextSibling)};window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)});